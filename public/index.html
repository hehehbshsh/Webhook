<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vercel Webhook Listener UI</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #0070f3; }
        pre { background: #eee; padding: 15px; border-radius: 4px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Webhook Listener Status</h1>
        <p>This page checks the Vercel function for the last received webhook payload.</p>
        <p><strong>Your Webhook URL (for the source app):</strong> <code>[Your Vercel URL]/api/webhook</code></p>
        
        <h2>Last Webhook Payload:</h2>
        <div id="status">Loading...</div>
        <pre id="payload-display">Fetching data...</pre>
    </div>

    <script>
        const statusDiv = document.getElementById('status');
        const payloadDisplay = document.getElementById('payload-display');

        async function fetchPayload() {
            try {
                // Fetch data from the Vercel Serverless Function (GET request)
                const response = await fetch('/api/webhook');
                const data = await response.json();
                
                statusDiv.textContent = data.lastPayload.includes('No webhook') ? 
                    'Status: Waiting for first webhook...' : 
                    'Status: Payload successfully received!';

                payloadDisplay.textContent = data.lastPayload;
            } catch (error) {
                statusDiv.textContent = 'Error fetching status.';
                payloadDisplay.textContent = error.message;
                console.error('Fetch error:', error);
            }
        }

        // Fetch data immediately and then every 5 seconds
        fetchPayload();
        setInterval(fetchPayload, 5000); 
    </script>
</body>
</html>
